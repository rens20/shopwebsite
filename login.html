<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>login - sign up</title>
    <link rel="stylesheet" href="create.css">

        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.css">

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">
</head>

<body>
    <img src="https://img.freepik.com/premium-vector/online-shop-logo-template-icon_6543-185.jpg" class="img">
    <h2 class="qoute">Welcome to online shop </h2>

    <div id="login">
        <input type="text" name="username"  placeholder="Username" required="Username" >
        <div class="password-container">
        <input type="password" name="password" autocomplete="current-password" required="" id="id_password" placeholder="Password">
        <i class="fas fa-eye toggle-password"></i>
        </div>
       <a onclick="btnLogin()" id="btnLogin">Log in</a>
       <a id="forget" href="">forget your password</a>
       <hr/>
      <a id="btn-create" href="createACCOUNT.html">Create new account</a>
    </div>

    
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.css">
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script>
     <script>
///////for toggle
document.querySelector('.toggle-password').addEventListener('click', function () {
      passwordInput = document.querySelector('input[name="password"]');
      if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
      } else {
        passwordInput.type = 'password';
      }
    });
    const makePostRequest = async (data, endpoint, callback) => {



	const sent = await fetch(endpoint, {
		method: 'POST',
        headers: {
        	'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
    })
    try {
    	const response = await sent.json()
        callback(response)
    } catch (error) {
        console.log(error)
        callback(error)
    }
}

        function btnLogin() {
    var username = document.getElementsByName('username')[0].value;
    var password = document.getElementsByName('password')[0].value;
           makePostRequest( { username, password }, 'https://nodejs-1.wasieacuna.repl.co/api/login', (msg) => {
             if(msg.code === 200) {
               alert("Logged in success!");
               localStorage.setItem('token', msg.token)
               window.location.href='/';
             } else {
               alert('Login failed')
             }
           })
        };
       </script>
       </body>
</html>